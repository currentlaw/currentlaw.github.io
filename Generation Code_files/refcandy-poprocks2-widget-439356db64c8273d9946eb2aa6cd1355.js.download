// TODO: Convert this to react component later?
var RCORNER=window.RCORNER||{};RCORNER.poprocks2=RCORNER.poprocks2||{};var poprocks2=RCORNER.poprocks2;poprocks2.Analytics=function a(a){this.registerGAEvent=function(b,c,d){if(!a)return;a.apply(null,["crossDomainTracker.send","event","Poprocks2",b,c,d].filter(function(a){return a!==undefined})),a.apply(null,["portalPageTracker.send","event","Poprocks2",b,c,d].filter(function(a){return a!==undefined}))},this.registerAdvocateEvent=function(a,b){var c={};return c.location="front_page_signup_widget",c.type=a,$.ajax({url:b,type:"POST",data:c}),!1}},poprocks2.Message=function b(a){this.cmd=a.cmd,this.options=a.options,this.json=function(){return JSON.stringify(this)}},poprocks2.Message.from=function(a){return new poprocks2.Message(JSON.parse(a))},poprocks2.Message.INIT="init",poprocks2.Message.RESIZE="resize",poprocks2.Message.UPDATE_STYLE="update_style",poprocks2.Message.DISABLE_PARENT_SCROLLING="disable_parent_scroll",poprocks2.Message.ENABLE_PARENT_SCROLLING="enable_parent_scroll",poprocks2.Message.CLICK_CUSTOM_URI="click_custom_uri",poprocks2.Channel=function c(a,b){this.element=a,this.origin=b,this.send=function(a){this.element.postMessage(a,this.origin)}},poprocks2.Widget=function d(a,b,c,d){this.analytics=c||new poprocks2.Analytics,this.handle=function(a){if(a.cmd===poprocks2.Message.INIT||a.cmd===poprocks2.Message.RESIZE)return this[a.cmd](a.options);console.log("Invalid command",a.cmd)},this.guard=function(a){return function(){if(!(this.rootElement&&this.channel&&this.accessID))return;a.apply(this,arguments)}.bind(this)},this.init=function(a){this.location=a.location,this.resize(a),this.useButtonBorder(),$(this.rootElement).addClass(a.location)},this.resize=this.guard(function(a){this.size=a,this.isSmallScreen()?$(this.rootElement).hasClass("small")||($(this.rootElement).addClass("small"),this.isFormShowing?this.useFormBorder():this.useButtonBorder()):$(this.rootElement).hasClass("small")&&($(this.rootElement).removeClass("small"),this.isFormShowing?this.useFormBorder():this.useButtonBorder())}),this.isSmallScreen=function(){return this.size.width<poprocks2.Widget.SMALL_SCREEN},this.isLargeScreen=function(){return this.size.width>=poprocks2.Widget.SMALL_SCREEN},this.updateStyle=this.guard(function(a){this.channel.send((new poprocks2.Message({cmd:poprocks2.Message.UPDATE_STYLE,options:a})).json())}),this.useFormBorder=this.guard(function(){var a={borderRadius:"10px 10px 0 0",overflow:"hidden",boxShadow:"2px 2px 5px 1px rgba(255, 255, 255, 0.1), 2px 2px 10px 1px rgba(0, 0, 0, 0.1)",left:"unset",right:"unset"};this.isSmallScreen()?(a.bottom="10px",a.top="10px",a.left="10px",a.right="10px",a.width="unset",a.height="unset"):(a.bottom="10px",a.top="unset",a[this.location]="10px",a.width="400px",a.height="550px"),this.updateStyle(a),this.isSmallScreen()&&this.channel.send((new poprocks2.Message({cmd:poprocks2.Message.DISABLE_PARENT_SCROLLING})).json())}),this.useButtonBorder=this.guard(function(){var a={width:$("#button").width()+15+"px",height:$("#button").height()+15+"px",overflow:"hidden",bottom:"10px",left:"unset",right:"unset",top:"unset",boxShadow:"unset"};a[this.location]="10px",this.updateStyle(a),this.isSmallScreen()&&this.channel.send((new poprocks2.Message({cmd:poprocks2.Message.ENABLE_PARENT_SCROLLING})).json())}),this.updateUser=this.guard(function(a){a=a||{},this.user={email:a.email,name:a.name||a.email,uri:a.uri};var b=document.getElementById("referral-url");b.value=this.user.uri;var c=document.getElementById("referral-name");c.textContent=this.user.name+"!"}),this.signup=this.guard(function(a,b,c){$.get("/signup/"+this.accessID+".json",{email:a,fname:b},c)}),this.toggleForm=function(){var a=!this.isFormShowing;a?($(".form",this.rootElement).addClass("active"),$(".button",this.rootElement).addClass("hidden"),this.useFormBorder(),this.analytics.registerGAEvent("open-widget")):($(".form",this.rootElement).removeClass("active"),$(".button",this.rootElement).removeClass("hidden"),this.useButtonBorder(),this.analytics.registerGAEvent("close-widget")),this.isFormShowing=a},this.createReferralLink=this.guard(function(a){a.preventDefault(),this.analytics.registerGAEvent("create-account");var b=document.getElementById("email").value,c=document.getElementById("name").value;this.signup(b,c,function(a){this.analytics.registerGAEvent("account-created","link",a.uri),this.updateUser({email:b,name:c,uri:a.uri}),this.updateSocialLinks({share_via_facebook:a.share_via_facebook,share_via_twitter:a.share_via_twitter,share_via_messenger_desktop_button:a.share_via_messenger_desktop_button,share_via_messenger_mobile_button:a.share_via_messenger_mobile_button,share_via_whatsapp_desktop_button:a.share_via_whatsapp_desktop_button,share_via_whatsapp_mobile_button:a.share_via_whatsapp_mobile_button});var d={"fb-button":"share_on_facebook_click","tweet-button":"share_on_twitter_click","whatsapp-desktop-button":"share_on_whatsapp_desktop_click","whatsapp-mobile-button":"share_on_whatsapp_mobile_click","messenger-desktop-button":"share_on_messenger_desktop_click","messenger-mobile-button":"share_on_messenger_mobile_click"};for(var e in d)document.getElementById(e)!==null&&document.getElementById(e).addEventListener("click",function(b){this.analytics.registerGAEvent(d[b]),this.analytics.registerAdvocateEvent(d[b],a.advocate_event_uri)}.bind(this,e));var f=navigator.userAgent,g=/iPad/i.test(f)||/iPhone/i.test(f),h=/WebKit/i.test(f),i=g&&h&&!/CriOS/i.test(f);i&&$("#messenger-mobile-button, #whatsapp-mobile-button").click(function(a){a.preventDefault(),this.channel.send((new poprocks2.Message({cmd:poprocks2.Message.CLICK_CUSTOM_URI,options:{location:$(a.currentTarget).attr("href")}})).json())}.bind(this)),$(".page").removeClass("active"),$("#referral-page").addClass("active")}.bind(this))}),this.updateSocialLinks=this.guard(function(a){a=a||{};var b=document.getElementById("fb-button");b.href=a.share_via_facebook;var c=document.getElementById("tweet-button");c.href=a.share_via_twitter;var d=document.getElementById("messenger-desktop-button");d.href=a.share_via_messenger_desktop_button;var e=document.getElementById("messenger-mobile-button");e.href=a.share_via_messenger_mobile_button;var f=document.getElementById("whatsapp-desktop-button");f.href=a.share_via_whatsapp_desktop_button;var g=document.getElementById("whatsapp-mobile-button");g.href=a.share_via_whatsapp_mobile_button}),this.inputActive=function(a){$(a.target.parentElement).addClass("active")},this.inputInactive=function(a){var b=a.target;b.value.length||$(a.target.parentElement).removeClass("active")},this.updateCopyButton=function(a){this.analytics.registerGAEvent("copy-link"),a.clearSelection(),$(a.trigger).siblings("#referral-url-copied-overlay").fadeIn(50).delay(1e3).fadeOut(600)},this.rootElement=a,this.channel=b,this.accessID=d,this.size={width:0,height:0},this.user={email:"",name:"",uri:""},this.isFormShowing=!1;if(a){var e=new Clipboard("#referral-url");e.on("success",this.updateCopyButton.bind(this)),this.clipboard=e}document.getElementById("button").addEventListener("click",this.toggleForm.bind(this)),document.getElementById("close-form").addEventListener("click",this.toggleForm.bind(this)),document.getElementById("create-referral-form").addEventListener("submit",this.createReferralLink.bind(this)),$(".page-input input").on("focus",this.inputActive.bind(this)),$(".page-input input").on("blur",this.inputInactive.bind(this))},poprocks2.Widget.SMALL_SCREEN=480;